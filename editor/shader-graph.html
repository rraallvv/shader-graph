<dom-module id="shader-graph">
	<link rel="import" type="css" href="css/bootstrap.css">
	<link rel="import" type="css" href="css/graph.css">
	<link rel="import" type="css" href="css/preview.css"/>

	<template>
		<div id="content" class="container-full">loading...</div>
	</template>

	<script src="js/external/jsplumb.js"></script>
	<script src="js/external/react.js"></script>
	<script src="js/external/react-dom.js"></script>
	<script src="js/external/require.js"></script>
	<script src="js/external/cocos2d-js.js"></script>
	<script src="js/external/glsl-optimizer-init.js"></script>
	<script src="js/external/glsl-optimizer.js"></script>
	<script src="../build/shadergraph.js"></script>
	<script src="generated/editor.js"></script>

	<!--<script type="text/babel">-->
	<script>
		if ( typeof Editor === "undefined" ) {
			window.Editor = { polymerElement: Polymer, log: console.log };
		}

		var shaderGraph;

		Editor.polymerElement({
			ready: function(){
				shaderGraph = this;
				setTimeout(function(){
					var appInstance = ReactDOM.render(React.createElement(App), shaderGraph.$.content);
					/*
					appInstance.addNode({type:"value", pos:[0, 0], value:70});
					appInstance.addNode({type:"uv", pos:[0, 100]});
					appInstance.addNode({type:"value", pos:[0, 220], value:35});
					appInstance.addNode({type:"value", pos:[0, 320], value:0.5});
					appInstance.addNode({type:"multiply", pos:[200, 50]});
					appInstance.addNode({type:"multiply", pos:[200, 150]});
					appInstance.addNode({type:"cos", pos:[350, 50]});
					appInstance.addNode({type:"sin", pos:[350, 150]});
					appInstance.addNode({type:"join", pos:[500, 100]});
					appInstance.addNode({type:"value", pos:[300, 300], value: 1});
					appInstance.connect(2, 6);
					appInstance.connect(3.1, 6.1);
					appInstance.connect(3.2, 7);
					appInstance.connect(4, 7.1);
					appInstance.connect(6, 8);
					appInstance.connect(7, 9);
					appInstance.connect(8, 10);
					appInstance.connect(9, 10.1);
					appInstance.connect(5, 10.2);
					appInstance.connect(11, 10.3);
					appInstance.connect(10, 1);
					*/
					var nodes = [
						{type:"fragColor", pos:[660, 200]},
						{type:"texture", pos:[0, 0]},
						{type:"split", pos:[0, 170]},
						{type:"add", pos:[135, 90]},
						{type:"add", pos:[267, 90]},
						{type:"divide", pos:[400, 90]},
						{type:"value", pos:[250, 175], value:3},
						{type:"join", pos:[530, 170]}
					];
					var links = [
						[2, 3],
						[3, 4],
						[3.1, 4.1],
						[4, 5],
						[3.2, 5.1],
						[5, 6],
						[7, 6.1],
						[6, 8],
						[6, 8.1],
						[6, 8.2],
						[3.3, 8.3],
						[8, 1]
					];
					for (var i = 0; i < nodes.length; i++) {
						appInstance.addNode(nodes[i]);
					}
					for (var i = 0; i < links.length; i++) {
						appInstance.connect(links[i][0], links[i][1]);
					}

				}, 1000);
			},
			setTransform: function( s, r, n, t ){
				// s = 1, r = 1, n = 0, t = 0;
				this.style.transform = "matrix(" +
					s + ", 0, 0, " +
					r + ", " +
					Math.round(n + 0.5 * this.offsetWidth * (s - 1)) + ", " +
					Math.round(t + 0.5 * this.offsetHeight * (r - 1)) + ")";
			}
		});
	</script>
</dom-module>
