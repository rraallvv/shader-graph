<dom-module id="shader-graph">
	<link rel="import" type="css" href="css/bootstrap.css">
	<link rel="import" type="css" href="css/graph.css">

	<template>
		<div id="content" class="container-full">loading...</div>
	</template>

	<script src="js/external/jsplumb.js"></script>
	<script src="js/external/react.js"></script>
	<script src="js/external/react-dom.js"></script>
	<script src="../build/shadergraph.js"></script>
	<script src="js/editor.js"></script>

	<!--<script type="text/babel">-->
	<script>
		if ( typeof Editor === "undefined" ) {
			window.Editor = { polymerElement: Polymer, log: console.log };
		}

		Editor.polymerElement({
			ready: function(){
				this._editor = ReactDOM.render(React.createElement(NodeEditor, {shaderGraph: this}), this.$.content);
			},
			updateShader: function() {
				this._editor.updateShader();
			},
			nodeList: function() {
				return this._editor.nodeTypes().map(function (type) {
					var item = document.createElement("a");
					item.type = item.innerHTML = type;
					return item;
				});
			},
			loadGraph: function(data) {
				this._editor.loadGraph(data);
			},
			addNode: function(e) {
				var b = graph.querySelector("#canvas").getBoundingClientRect();
				var pos = e.pos || [0, 0];
				pos[0] -= b.left;
				pos[1] -= b.top;
				e.pos = pos;
				this._editor.addNode(e);
			},
			setTransform: function( s, r, n, t ){
				// s = 1, r = 1, n = 0, t = 0;
				this.style.transform = "matrix(" +
					s + ", 0, 0, " +
					r + ", " +
					Math.round(n + 0.5 * this.offsetWidth * (s - 1)) + ", " +
					Math.round(t + 0.5 * this.offsetHeight * (r - 1)) + ")";
			}
		});
	</script>
</dom-module>
