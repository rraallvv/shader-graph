<link rel="import" href="preview-view.html">

<dom-module id="shader-graph">
	<link rel="import" type="css" href="css/bootstrap.css">
	<link rel="import" type="css" href="css/graph.css">

	<template>
		<div id="content" class="container-full">loaded!</div>
	</template>

	<script src="js/external/jsplumb.js"></script>
	<script src="js/external/react.js"></script>
	<script src="js/external/react-dom.js"></script>
	<script src="js/external/require.js"></script>
	<script src="js/external/goo.js"></script>
	<script src="../build/shadergraph.js"></script>
	<script src="generated/editor.js"></script>

	<!--<script type="text/babel">-->
	<script>
		if ( typeof Editor === "undefined" ) {
			window.Editor = { polymerElement: Polymer, log: console.log };
		}

		var shaderGraph;

		Editor.polymerElement({
			ready: function(){
				shaderGraph = this;
				setTimeout(function(){
					var appInstance = ReactDOM.render(React.createElement(App), shaderGraph.$.content);
					/*
					appInstance.addNode({type:"value", pos:[0, 0], value:70});
					appInstance.addNode({type:"uv", pos:[0, 100]});
					appInstance.addNode({type:"value", pos:[0, 220], value:35});
					appInstance.addNode({type:"value", pos:[0, 320], value:0.5});
					appInstance.addNode({type:"multiply", pos:[200, 50]});
					appInstance.addNode({type:"multiply", pos:[200, 150]});
					appInstance.addNode({type:"cos", pos:[350, 50]});
					appInstance.addNode({type:"sin", pos:[350, 150]});
					appInstance.addNode({type:"join", pos:[500, 100]});
					appInstance.addNode({type:"value", pos:[300, 300], value: 1});
					appInstance.connect(2, 6);
					appInstance.connect(3.1, 6.1);
					appInstance.connect(3.2, 7);
					appInstance.connect(4, 7.1);
					appInstance.connect(6, 8);
					appInstance.connect(7, 9);
					appInstance.connect(8, 10);
					appInstance.connect(9, 10.1);
					appInstance.connect(5, 10.2);
					appInstance.connect(11, 10.3);
					appInstance.connect(10, 1);
					*/
					appInstance.addNode({type:"uv", pos:[0,0]});
					appInstance.addNode({type:"texture", pos:[120, 0]});
					appInstance.addNode({type:"split", pos:[120, 220]});
					appInstance.addNode({type:"add", pos:[270, 140]});
					appInstance.addNode({type:"add", pos:[400, 140]});
					appInstance.addNode({type:"divide", pos:[520, 140]});
					appInstance.addNode({type:"value", pos:[380, 235], value:3});
					appInstance.addNode({type:"join", pos:[650, 230]});
					appInstance.connect(2, 3);
					appInstance.connect(3, 4);
					appInstance.connect(4, 5);
					appInstance.connect(4.1, 5.1);
					appInstance.connect(5, 6);
					appInstance.connect(4.2, 6.1);
					appInstance.connect(6, 7);
					appInstance.connect(8, 7.1);
					appInstance.connect(7, 9);
					appInstance.connect(7, 9.1);
					appInstance.connect(7, 9.2);
					appInstance.connect(4.3, 9.3);
					appInstance.connect(9, 1);

				}, 1000);
			},
			setTransform: function( s, r, n, t ){
				// s = 1, r = 1, n = 0, t = 0;
				this.style.transform = "matrix(" +
					s + ", 0, 0, " +
					r + ", " +
					Math.round(n + 0.5 * this.offsetWidth * (s - 1)) + ", " +
					Math.round(t + 0.5 * this.offsetHeight * (r - 1)) + ")";
			}
		});
	</script>
</dom-module>
